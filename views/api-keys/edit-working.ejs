<%- include('../layouts/main', { 
    title: 'Edit API Key',
    activeMenu: 'api-keys',
    body: ` 
    <div class="max-w-2xl mx-auto">
        <div class="bg-white shadow rounded-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Edit API Key</h1>
                    <p class="text-gray-600 mt-1">Update API key settings for ${apiKey.app_name}</p>
                </div>
                <a href="/api-keys" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded text-gray-700">
                    ‚Üê Back to List
                </a>
            </div>

            <form method="post" action="/api-keys/${apiKey.api_key_id}/update" class="space-y-6">
                <input type="hidden" name="_csrf" value="${csrfToken}">
                
                <!-- API Key ID (Read-only) -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">API Key ID</label>
                    <input type="text" value="${apiKey.api_key_id}" disabled
                           class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed">
                    <p class="mt-1 text-sm text-gray-500">This ID cannot be changed</p>
                </div>

                <!-- Application Name -->
                <div>
                    <label for="app_name" class="block text-sm font-medium text-gray-700 mb-1">
                        Application Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="app_name" name="app_name" required
                           value="${apiKey.app_name}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                           placeholder="e.g., Mobile App, Analytics Dashboard">
                </div>

                <!-- Description -->
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="description" name="description" rows="3"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                              placeholder="Describe the purpose of this API key...">${apiKey.description || ''}</textarea>
                </div>

                <!-- Permissions -->
                <div>
                    <label for="permissions" class="block text-sm font-medium text-gray-700 mb-1">
                        Permissions <span class="text-red-500">*</span>
                    </label>
                    <select id="permissions" name="permissions" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        <option value="read" ${apiKey.permissions === 'read' ? 'selected' : ''}>
                            Read Only - Can view organization data
                        </option>
                        <option value="write" ${apiKey.permissions === 'write' ? 'selected' : ''}>
                            Write Only - Can modify organization data
                        </option>
                        <option value="read,write" ${apiKey.permissions === 'read,write' ? 'selected' : ''}>
                            Read & Write - Full access to organization data
                        </option>
                    </select>
                </div>

                <!-- Expiration Date -->
                <div>
                    <label for="expires_date" class="block text-sm font-medium text-gray-700 mb-1">Expiration Date</label>
                    <input type="date" id="expires_date" name="expires_date"
                           min="${new Date().toISOString().split('T')[0]}"
                           value="${apiKey.expires_date ? new Date(apiKey.expires_date).toISOString().split('T')[0] : ''}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <p class="mt-1 text-sm text-gray-500">Leave empty for no expiration</p>
                </div>

                <!-- Status Info -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Current Status</h3>
                    <p class="text-sm">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${apiKey.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${apiKey.is_active ? '‚úÖ Active' : '‚ùå Inactive'}
                        </span>
                    </p>
                    ${apiKey.last_used_date ? `
                        <p class="text-sm text-gray-600 mt-2">
                            Last used: ${new Date(apiKey.last_used_date).toLocaleDateString()}
                        </p>
                    ` : ''}
                </div>

                <!-- Timestamps -->
                <div class="border-t pt-4 text-sm text-gray-500">
                    ${apiKey.created_date ? `
                        <p>Created: ${new Date(apiKey.created_date).toLocaleString()}
                           ${apiKey.created_by ? `by ${apiKey.created_by}` : ''}
                        </p>
                    ` : ''}
                    ${apiKey.updated_date ? `
                        <p>Updated: ${new Date(apiKey.updated_date).toLocaleString()}
                           ${apiKey.updated_by ? `by ${apiKey.updated_by}` : ''}
                        </p>
                    ` : ''}
                </div>

                <!-- Form Actions -->
                <div class="flex items-center justify-between border-t pt-6">
                    <div class="flex space-x-3">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-colors">
                            üíæ Save Changes
                        </button>
                        <a href="/api-keys/${apiKey.api_key_id}" class="bg-gray-200 hover:bg-gray-300 px-6 py-2 rounded-md text-gray-700 transition-colors">
                            Cancel
                        </a>
                    </div>
                </div>
            </form>
        </div>

        <!-- Additional Actions -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Regenerate API Key -->
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="font-semibold text-gray-900 mb-2">üîÑ Regenerate API Key</h3>
                <p class="text-sm text-gray-600 mb-3">
                    Generate a new API key. The current key will be invalidated.
                </p>
                <form method="POST" action="/api-keys/${apiKey.api_key_id}/regenerate" class="inline">
                    <input type="hidden" name="_csrf" value="${csrfToken}">
                    <button type="submit" 
                            onclick="return confirm('Are you sure? The current API key will no longer work.')"
                            class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded text-sm transition-colors">
                        üîÑ Regenerate Key
                    </button>
                </form>
            </div>

            <!-- Toggle Status -->
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="font-semibold text-gray-900 mb-2">
                    ${apiKey.is_active ? '‚è∏Ô∏è Deactivate' : '‚ñ∂Ô∏è Activate'} API Key
                </h3>
                <p class="text-sm text-gray-600 mb-3">
                    ${apiKey.is_active 
                        ? 'This will immediately block all requests using this API key.' 
                        : 'This will allow the API key to be used for requests.'}
                </p>
                <form method="POST" action="/api-keys/${apiKey.api_key_id}/toggle-status" class="inline">
                    <input type="hidden" name="_csrf" value="${csrfToken}">
                    <button type="submit" 
                            onclick="return confirm('Are you sure you want to ${apiKey.is_active ? 'deactivate' : 'activate'} this API key?')"
                            class="${apiKey.is_active ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'} text-white px-4 py-2 rounded text-sm transition-colors">
                        ${apiKey.is_active ? '‚è∏Ô∏è Deactivate' : '‚ñ∂Ô∏è Activate'} Key
                    </button>
                </form>
            </div>
        </div>
    </div>
    `
}) %>