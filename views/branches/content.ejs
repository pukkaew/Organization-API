<!-- Path: /views/branches/content.ejs -->
    <div class="space-y-6">
    <!-- Page Header -->
    <%- include('../partials/page-header', { 
        title: 'Branches',
        description: 'Manage all branches across your organization',
        icon: 'code-branch',
        iconColor: 'green',
        addUrl: '/branches/new',
        addText: 'เพิ่มสาขาใหม่'
    }) %>
    
    <!-- Filters Section -->
    <%- include('../partials/filter-card', { 
        action: '/branches',
        filters: typeof query !== 'undefined' ? query : {},
        entityType: 'branches',
        companies: typeof companies !== 'undefined' ? companies : []
    }) %>
    
    <!-- Branches Table -->
    <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg fast-table">
        <div class="overflow-x-auto">
            <div class="table-wrapper">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-green-600 text-white">
                        <tr>
                            <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-white uppercase tracking-wider">
                                <i class="fas fa-code-branch mr-2"></i>Branch Code
                            </th>
                            <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-white uppercase tracking-wider">
                                <i class="fas fa-code-branch mr-2"></i>Branch Name
                            </th>
                            <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-white uppercase tracking-wider">
                                <i class="fas fa-building mr-2"></i>Company
                            </th>
                            <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-white uppercase tracking-wider">
                                <i class="fas fa-tag mr-2"></i>Type
                            </th>
                            <th scope="col" class="px-6 py-4 text-center text-xs font-bold text-white uppercase tracking-wider">
                                <i class="fas fa-chart-bar mr-2"></i>Status
                            </th>
                            <th scope="col" class="px-6 py-4 text-center text-xs font-bold text-white uppercase tracking-wider">
                                <i class="fas fa-cogs mr-2"></i>Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <% if (typeof branches !== 'undefined' && branches.length > 0) { %>
                            <% branches.forEach(function(branch, index) { %>
                                <tr class="<%= index % 2 === 0 ? 'bg-white' : 'bg-gray-50' %> hover:bg-blue-50 hover:shadow-md transition-all duration-200">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-700 rounded-xl flex items-center justify-center mr-3 shadow-md hover:shadow-lg transition-all duration-200">
                                                <i class="fas fa-code-branch text-white text-base drop-shadow-sm"></i>
                                            </div>
                                            <div class="text-sm font-medium text-gray-900">
                                                <%= branch.branch_code %>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">
                                            <%= branch.branch_name %>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-500">
                                            <%= branch.company_code %> - <%= branch.company_name_th || branch.company_name_en || '' %>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <% if (branch.is_headquarters) { %>
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                <i class="fas fa-building"></i>
                                                Headquarters
                                            </span>
                                        <% } else { %>
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                <i class="fas fa-code-branch"></i>
                                                Branch
                                            </span>
                                        <% } %>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">
                                        <%- include('../partials/status-badge', { isActive: branch.is_active }) %>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">
                                        <%- include('../partials/action-buttons', { 
                                            entity: 'branches', 
                                            code: branch.branch_code, 
                                            isActive: branch.is_active,
                                            csrfToken: typeof csrfToken !== 'undefined' ? csrfToken : null
                                        }) %>
                                    </td>
                                </tr>
                            <% }); %>
                        <% } else { %>
                            <tr>
                                <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                                    No branches found.
                                </td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Pagination -->
    <% if (typeof pagination !== 'undefined' && pagination.pages > 1) { %>
        <%- include('../partials/pagination', { pagination, query: typeof query !== 'undefined' ? query : {} }) %>
    <% } %>
</div>

<script>
    // Delete confirmation
    function confirmDelete(branchCode) {
        if (confirm('Are you sure you want to delete branch ' + branchCode + '?\n\nThis action cannot be undone.')) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/branches/' + branchCode + '/delete';
            
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;
            if (csrfToken) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = '_csrf';
                input.value = csrfToken;
                form.appendChild(input);
            }
            
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>
    </div>